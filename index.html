<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>バット軌道ビューア - 選手一覧</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    margin: 20px;
    background: #f4f4f4;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .player {
    background: white;
    padding: 16px;
    margin-bottom: 16px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  details summary {
    font-size: 1.2em;
    cursor: pointer;
    font-weight: bold;
    padding: 5px 0;
  }
  .links a {
    display: inline-block;
    margin: 4px 6px;
    padding: 6px 12px;
    background: #1976d2;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.9em;
  }
  .links a:hover {
    background: #0d47a1;
  }
</style>
</head>
<body>

<h1>バット軌道ビューア - 選手一覧</h1>

<script>
// ===== リポジトリ情報 =====
// ★ここを正しいアカウント名にする（u が2つ）
const repo = "sakuubi2356/Swing-Trajectory";

// Z番号 → コース名 変換
// right のとき：Z1=インハイ, Z3=アウトハイ, Z5=真ん中, Z7=インロー, Z9=アウトロー
// left  のとき：Z1=アウトハイ, Z3=インハイ, Z5=真ん中, Z7=アウトロー, Z9=インロー
function getCourseLabel(course, side) {
  const mapRight = {
    "Z1": "インハイ",
    "Z3": "アウトハイ",
    "Z5": "真ん中",
    "Z7": "インロー",
    "Z9": "アウトロー"
  };
  const mapLeft = {
    "Z1": "アウトハイ",
    "Z3": "インハイ",
    "Z5": "真ん中",
    "Z7": "アウトロー",
    "Z9": "インロー"
  };

  const map = side === "right" ? mapRight
            : side === "left"  ? mapLeft
            : null;

  if (map && map[course]) return map[course];
  return course; // 対応なしはそのまま
}

// ===== GitHub API から right / left の中身を取得 =====
async function loadFiles() {
  const sides = ["right", "left"];
  const allEntries = [];

  for (const side of sides) {
    const url = `https://api.github.com/repos/${repo}/contents/${side}`;
    try {
      const res = await fetch(url);
      const data = await res.json();

      // 失敗してたらスキップ
      if (!Array.isArray(data)) {
        console.warn("GitHub API error:", side, data);
        continue;
      }

      const htmlFiles = data.filter(item => item.name.endsWith(".html"));

      htmlFiles.forEach(item => {
        const base = item.name.replace(/\.html$/,"");
        const parts = base.split("_");
        if (parts.length < 2) return;

        // 最後の _ の前までを名前、最後の部分をコースとみなす
        const course = parts.pop();           // 例: Z1
        const player = parts.join("_");       // 例: Ando, Nomura_1120 など

        allEntries.push({
          player: player,
          course: course,
          side: side,
          filename: `${side}/${item.name}`
        });
      });
    } catch (e) {
      console.error("fetch failed:", side, e);
    }
  }

  buildUI(allEntries);
}

// ===== UI 自動生成 =====
function buildUI(entries) {
  const players = {};

  entries.forEach(e => {
    if (!players[e.player]) players[e.player] = [];
    players[e.player].push(e);
  });

  const container = document.createElement("div");

  Object.keys(players).sort().forEach(player => {
    const div = document.createElement("div");
    div.className = "player";

    const details = document.createElement("details");
    const summary = document.createElement("summary");
    summary.textContent = player;
    details.appendChild(summary);

    const links = document.createElement("div");
    links.className = "links";

    players[player]
      .sort((a, b) => a.course.localeCompare(b.course, undefined, { numeric: true }))
      .forEach(entry => {
        const a = document.createElement("a");
        a.href = entry.filename;

        const label = getCourseLabel(entry.course, entry.side);
        a.textContent = label;
        a.title = `${entry.side === "right" ? "右" : "左"}打席 / ${entry.course}`;

        links.appendChild(a);
      });

    details.appendChild(links);
    div.appendChild(details);
    container.appendChild(div);
  });

  document.body.appendChild(container);
}

loadFiles();
</script>

</body>
</html>
